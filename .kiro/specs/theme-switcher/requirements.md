# Requirements Document

## Introduction

ユーザーがWebアプリケーションでダークモードとライトモードを手動で切り替えられる機能を実装します。現在のアプリは`prefers-color-scheme`によるシステム設定に基づく自動テーマ切り替えに対応していますが、ユーザーが明示的にテーマを選択できる機能を追加します。この機能により、ユーザーは自分の好みや使用環境に応じてテーマを自由に変更でき、設定は永続化されます。

## Requirements

### Requirement 1

**User Story:** ユーザーとして、アプリケーションのテーマ（ダークモード・ライトモード）を手動で切り替えたい。これにより、システム設定に関係なく自分の好みに合わせてアプリの外観を調整できる。

#### Acceptance Criteria

1. WHEN ユーザーがテーマ切り替えボタンをクリック THEN システムは現在のテーマを反対のテーマに切り替える SHALL
2. WHEN テーマが切り替えられた THEN アプリケーション全体の色彩が即座に新しいテーマに更新される SHALL
3. WHEN ユーザーがライトモードを選択 THEN 背景色は明るい色、テキストは暗い色で表示される SHALL
4. WHEN ユーザーがダークモードを選択 THEN 背景色は暗い色、テキストは明るい色で表示される SHALL

### Requirement 2

**User Story:** ユーザーとして、選択したテーマ設定が次回アプリを開いた時も保持されていてほしい。これにより、毎回テーマを設定し直す必要がない。

#### Acceptance Criteria

1. WHEN ユーザーがテーマを変更 THEN システムは選択されたテーマをローカルストレージに保存する SHALL
2. WHEN ユーザーがアプリを再度開く THEN システムは保存されたテーマ設定を読み込んで適用する SHALL
3. IF ユーザーが初回訪問でテーマ設定が存在しない THEN システムはシステムの`prefers-color-scheme`設定を使用する SHALL
4. WHEN 保存されたテーマ設定が存在する THEN システムはシステム設定よりもユーザーの選択を優先する SHALL

### Requirement 3

**User Story:** ユーザーとして、画面右下に固定されたトグル式のテーマ切り替えボタンを使いたい。これにより、アプリのどの画面からでも簡単にテーマを切り替えることができる。

#### Acceptance Criteria

1. WHEN アプリが表示される THEN 画面右下にテーマ切り替えボタンが固定位置で表示される SHALL
2. WHEN テーマ切り替えボタンが表示される THEN トグル式のデザインで現在のテーマ状態を示すアイコンが表示される SHALL
3. WHEN ライトモードが選択されている THEN ボタンには太陽アイコンが表示される SHALL
4. WHEN ダークモードが選択されている THEN ボタンには月アイコンが表示される SHALL
5. WHEN ユーザーがスクロールしても THEN ボタンは常に画面右下の同じ位置に表示される SHALL
6. WHEN テーマが切り替わる THEN ボタンのアイコンも即座に新しい状態に更新される SHALL

### Requirement 4

**User Story:** ユーザーとして、テーマ切り替え機能がアクセシブルであってほしい。これにより、スクリーンリーダーやキーボード操作を使用するユーザーも機能を利用できる。

#### Acceptance Criteria

1. WHEN テーマ切り替えボタンが表示される THEN 適切なARIAラベルが設定される SHALL
2. WHEN ユーザーがキーボードでボタンにフォーカス THEN 視覚的なフォーカスインジケーターが表示される SHALL
3. WHEN ユーザーがEnterキーまたはSpaceキーを押下 THEN テーマが切り替わる SHALL
4. WHEN テーマが変更される THEN スクリーンリーダーに変更内容が適切に通知される SHALL

### Requirement 5

**User Story:** ユーザーとして、テーマ切り替えがスムーズで快適な体験であってほしい。これにより、テーマ変更時にちらつきや不自然な動作がない。

#### Acceptance Criteria

1. WHEN テーマが切り替わる THEN 色の変更はスムーズなトランジション効果で行われる SHALL
2. WHEN ページが読み込まれる THEN 保存されたテーマが適用されるまでのちらつきを最小限に抑える SHALL
3. WHEN テーマ切り替えボタンがクリックされる THEN 0.3秒以内にテーマ変更が完了する SHALL
4. WHEN 固定ボタンにホバーした THEN 視覚的なフィードバック（影やスケール変化）が表示される SHALL
5. IF ユーザーが`prefers-reduced-motion`を設定している THEN トランジション効果は無効化される SHALL

### Requirement 6

**User Story:** ユーザーとして、固定されたテーマ切り替えボタンが他のUI要素と干渉しないでほしい。これにより、アプリの使いやすさが損なわれない。

#### Acceptance Criteria

1. WHEN 固定ボタンが表示される THEN 他のコンテンツやボタンと重ならない適切なz-indexが設定される SHALL
2. WHEN モバイルデバイスで表示される THEN ボタンサイズは最低44px×44pxのタッチターゲットサイズを満たす SHALL
3. WHEN ボタンが表示される THEN 画面端から適切な余白（16px以上）を保つ SHALL
4. WHEN 小さな画面サイズで表示される THEN ボタンが他の重要なUI要素を隠さない SHALL
