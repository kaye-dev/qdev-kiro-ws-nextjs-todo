# 実装計画

- [x] 1. テーマの型定義とユーティリティ関数を作成
  - テーマシステム用のTypeScript型定義を作成
  - テーマ検出と解決のユーティリティ関数を実装
  - ユーティリティ関数のユニットテストを作成
  - _Requirements: 2.3, 2.4_

- [x] 2. ThemeProviderコンテキストを実装
  - テーマ状態管理用のReact Contextを作成
  - localStorage統合によるテーマ状態の初期化を実装
  - matchMedia APIを使用したシステムテーマ検出を追加
  - テーマの永続化とHTMLクラス適用を処理
  - ThemeProvider機能のユニットテストを作成
  - _Requirements: 2.1, 2.2, 2.3, 2.4_

- [x] 3. useThemeカスタムフックを作成
  - テーマコンテキストにアクセスするカスタムフックを実装
  - プロバイダー外での使用時のエラーハンドリングを追加
  - フック機能のユニットテストを作成
  - _Requirements: 2.1, 2.2_

- [x] 4. ThemeToggleボタンコンポーネントを構築
  - 固定位置のトグルボタンコンポーネントを作成
  - テーマに応じたアイコン（太陽/月）を実装
  - テーマ切り替えのクリックハンドラーを追加
  - Tailwind CSSクラスで適切なスタイリングを適用
  - コンポーネント動作のユニットテストを作成
  - _Requirements: 1.1, 1.2, 3.1, 3.2, 3.3, 3.4, 3.5, 3.6_

- [x] 5. ThemeToggleにアクセシビリティ機能を追加
  - ARIAラベルと説明を実装
  - キーボードナビゲーション（Enter/Spaceキー）サポートを追加
  - テーマ変更のスクリーンリーダー通知を含める
  - 適切なフォーカス管理と視覚的インジケーターを確保
  - アクセシビリティテストを作成
  - _Requirements: 4.1, 4.2, 4.3, 4.4_

- [x] 6. スムーズなトランジションとアニメーションを実装
  - テーマ色変更のCSSトランジションを追加
  - トグルボタンのホバーとフォーカス効果を実装
  - アイコントランジションアニメーションを追加
  - prefers-reduced-motionユーザー設定を尊重
  - アニメーション動作のテストを作成
  - _Requirements: 5.1, 5.2, 5.3, 5.4, 5.5_

- [x] 7. レスポンシブデザインと配置を確保
  - 全画面サイズでの適切な固定配置を実装
  - モバイルでの最小タッチターゲットサイズ（44px×44px）を確保
  - 画面端からの適切な余白を追加
  - UI競合を避けるためのz-indexレイヤリングをテスト
  - レスポンシブデザインテストを作成
  - _Requirements: 6.1, 6.2, 6.3, 6.4_

- [x] 8. 手動テーマ制御用のCSSを更新
  - 手動テーマクラスをサポートするようglobals.cssを修正
  - テーマ切り替え用のCSSカスタムプロパティを更新
  - 既存のdark:クラスとの互換性を確保
  - 全コンポーネントでのテーマ適用をテスト
  - _Requirements: 1.3, 1.4, 5.1_

- [x] 9. ThemeProviderをアプリレイアウトに統合
  - layout.tsxでアプリケーションをThemeProviderでラップ
  - レイアウトにThemeToggleコンポーネントを追加
  - 適切なコンポーネント階層とコンテキスト可用性を確保
  - 既存のTodoAppコンポーネントとの統合をテスト
  - _Requirements: 1.1, 1.2, 2.1, 2.2_

- [x] 10. 包括的な統合テストを追加
  - ページリロード間でのテーマ永続化をテスト
  - 既存の全コンポーネントへのテーマ適用を検証
  - システムテーマ検出とフォールバック動作をテスト
  - localStorageエラーハンドリングが正しく動作することを確認
  - テーマ選択から永続化までの完全なユーザーワークフローをテスト
  - _Requirements: 2.1, 2.2, 2.3, 2.4, 5.2_
